<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Web audio api test</title>
      <script   src="https://code.jquery.com/jquery-3.1.0.min.js"   integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s="   crossorigin="anonymous"></script> 
  </head>
  <body>

<script>
   
        
        var audioContext = new(AudioContext || webkitAudioContext)();

var frequencyOffset = 0
  // Our sound source is a simple triangle oscillator
var oscillator = audioContext.createOscillator(); // Create sound source  
oscillator.type = 'triangle';

// Adding a gain node just to lower the volume a bit and to make the
// sound less ear-piercing. It will also allow us to mute and replay
// our sound on demand
var gainNode = audioContext.createGain();
oscillator.connect(gainNode);
gainNode.connect(audioContext.destination);
    
var  direction='up';
gainNode.gain.value = 0;
var pitch=200;    
oscillator.frequency.value = pitch;
oscillator.start(0);

function boop() {
    
  gainNode.gain.value = 0.2;
  // The sound should last for 250ms
  setTimeout(function() {
      
    var now = audioContext.currentTime;  
    gainNode.gain.linearRampToValueAtTime(0,now+.05);
      
   if(direction=="up"){
        pitch=pitch/1.618;
    }  else {
        pitch=pitch*1.618;
    }    

    if(pitch>2000){
        direction="up";   
    } else if(pitch<60){
        direction="down";
    }    
    
    oscillator.frequency.setValueAtTime(pitch, now+.05);
     // oscillator.frequency.value=pitch;
      
  }, 250);
  oscillator.frequency.value++;
}

$(document).click(function(){
    boop();
});
        
        
    
   /*  $( function() {
    
    var context = new AudioContext();
      window.context = context;
     

      // this is where our oscillator will live
     

      // numbers we'll need later
      var width   = $(window).width();
      var height  = $(window).height();
      var xValue  = 0;
      var yValue  = 0;
      var pitch=2000;    
      var  direction='up';
      var oscillator;
      var gainNode = context.createGain();
      gainNode.connect(context.destination);
        
        // recalculate the width and height if the window size changes
      $(window).resize( function() {
        width   = $(this).width();
        height  = $(this).height();
      });
        
        
         $(document).on('mousedown', function(e) {
         
        if(oscillator){

            gainNode.gain.value = 0;
            console.log('stopping');
            oscillator.stop(context.currentTime+.05);

        }
             
        if(direction=="up"){
            pitch=pitch/1.618;
        }  else {
            pitch=pitch*1.618;
        }    
             
        if(pitch>2000){
            direction="up";   
        } else if(pitch<60){
            direction="down";
        }    
                  
        // create the oscillator
        oscillator = context.createOscillator();
             
        oscillator.frequency.value = pitch;
        oscillator.connect(gainNode);

        gainNode.gain.value=5;
     
        // set the type of the oscillator
        oscillator.type = 'triangle'; // sine, triangle, sawtooth
        // set the frequency based on our stored values
        oscillator.frequency.value = pitch;
        // connect it to the output
        oscillator.connect(context.destination);
        // start the note
        oscillator.start();
        //oscillator.stop(.2);
         
            
      });

});

// mtof = Midi note to Frequency
// input: 0 - 127 (although you could go higher if you wanted)
// output: frequency in Hz from ~8Hz to ~12543Hz
function mtof(note) {
  return 240.0;
}*/
        
        </script>
  </body>
</html>

